<!-- <h1>Final Order</h1>
<%#= form_for @master_order do |order|%>
  <%#= order.label:order_type%>
  <%#= order.select(:order_type, MasterOrder.order_types.keys) %> </br>
  <%#= order.label:payment_type%>
  <%#= order.select(:payment_type, MasterOrder.payment_types.keys) %> </br>
  <%#= order.label:restaurant%>

  <%#= order.select :restaurant_id, Restaurant.find(Order.find(session[:order].compact.keys).pluck(:restaurant_id).uniq).map{|r| [r.name, r.id]} %> </br>
  <%#= order.submit "place order"%>
<%#end%>
-->

<div id="wrapper">
  <!-- ****** Checkout Area Start ****** -->
  <div class="checkout_area section_padding_100">
    <div class="container">
      <div class="row">

        <div class="col-12 col-md-6">
          <%if current_user%>
            <div class="accdet"><i class="fa fa-plus-square" aria-hidden="true"></i>&nbsp;Account
            </div>  
          <%else%>
            <div class="accdet"><i class="fa fa-minus-square" aria-hidden="true"></i>&nbsp;Account
            </div>
          <%end%>
          <div class="accenter">To place your order now, log in to your existing account or sign up.<br>
            <a class="btn sign1">Login</a>
            <a class="btn sign2">Sign Up</a>
          
          <div class="signupform">
            Already An User ?<span class="signin">Sign In </span>
            <%= form_for(:user, :url => registration_path(:user)) do |f| %>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <%= f.label :first_name %> <span>*</span>
                  <%= f.text_field :firstname, autofocus: true, class: "form-control" %>
                </div>
                <div class="col-md-6 mb-3">
                  <%= f.label :last_name%><span>*</span>
                  <%= f.text_field :lastname, class: "form-control"%>
                </div>
                <div class="col-md-6 mb-3">
                  <%= f.label :user_name%><span>*</span>
                  <%= f.text_field :username, class: "form-control"%>
                </div>
                <div class="col-md-6 mb-3">
                  <%= f.label :phone_no%><span>*</span>
                  <%= f.text_field :phoneno, class: "form-control"%>
                </div>
                <div class="col-12 mb-4">
                  <%= f.label :email%><span>*</span>
                  <%= f.email_field :email, class: "form-control" %>
                </div>
                <div class="col-md-6 mb-3">
                  <%= f.label :password %><span>*</span>
              <% if @minimum_password_length %>
              <em>(<%= @minimum_password_length %> characters minimum)</em>
              <% end %><br />
              <%= f.password_field :password, autocomplete: "off",class: "form-control" %>
                </div>
                <div class="col-md-6 mb-3">
                  <%= f.label :password_confirmation %><span>*</span>
              <%= f.password_field :password_confirmation, autocomplete: "off",class: "form-control" %>
                </div>
                <div class="col-12 mb-4">
                  <%= f.label :Profile_Pic %><br />
                  <%= f.file_field :image%>
                </div>
                <div class="col-12 mb-4">
                  <%= f.submit "Sign Up",class: "btn signup"%>
                </div>
              </div>
            <%end%>
          </div>

          <div class="loginform">
            Not An User ? <span class="signuplink">Sign Up</span>
            <%= form_for(:user, :url => session_path(:user)) do |f| %>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <%= f.label :email%><span>*</span>
                  <%= f.email_field :email, class: "form-control" %>
                </div>
                <div class="col-md-6 mb-3">
                  <%= f.label :password %><br />
                  <%= f.password_field :password, autocomplete: "off", class: "form-control" %>
              </div>
              <div class="col-12 mb-4">
                <%= f.submit "Sign In",class: "btn login"%>
              </div>
            <%end%>
          </div>
        </div>
          </div>
          <br>
          <%if current_user%>
          <div class="deldet"><i class="fa fa-minus-square" aria-hidden="true"></i>&nbsp;Delivery Details
          </div>
          <%else%>
          <div class="deldet"><i class="fa fa-plus-square" aria-hidden="true"></i>&nbsp;Delivery Details
          </div>
          <%end%>
          <div class="checkout_details_area mt-50 clearfix">

            <div class="cart-page-heading">
              <h5>Billing Address</h5>
            </div>
            <a class="btn add">Add New Address</a><br><br>
                <%if @addresses == nil %>
                 Please Add Address For Home Delivery 
                <%else%>
                  <% current_user.addresses.each do |add|%>
                    <pre>
                      <%= add.display_address %><br>
                    </pre>
                  <%end%>
                <%end%>
              <div class="addform">
                Please Add Address For Home Delivery.
                <%=form_for @address do |form| %>
                  <% if @address.errors.any? %>
                    <div id="error_explanation">  
                    <h2>
                      <%= pluralize(@address.errors.count, "error") %> prohibited
                      this article from being saved:
                    </h2>
                    <ul>
                      <% @address.errors.full_messages.each do |msg| %>
                      <li><%= msg %></li>
                      <% end %>
                    </ul>
                    </div>
                  <% end %>
                  <div class="row">
                    <div class="col-12 mb-3">
                      <%= form.label :addressline %><span>*</span>
                      <%= form.text_field :addressline, class: "form-control" %>
                    </div>
                    <div class="col-md-6 mb-3">
                      <%= form.label :area %><span>*</span>
                      <%= form.text_field :area, class: "form-control" %>
                    </div>
                    <div class="col-md-6 mb-3">
                       <%= form.label :pincode %>
                       <%= form.text_field :pincode, class: "form-control" %>
                    </div>
                    <div class="col-md-6 mb-3">
                      <%= form.label :state %><span>*</span>
                      <%= form.select :state, CS.states(:in),class: "custom-select d-block w-100"%> 
                    </div>
                    <div class="col-md-6 mb-3">
                      <div id='city-list' remote: true>
                        <%= render partial: 'addresses/city_list',class: "custom-select d-block w-100"%> <%#= f.text_field :city %> 
                      </div>
                    </div>
                     <div class="col-12 mb-4">
                      <%= form.submit "Add Address",class: "btn"%>
                    </div>
                    </div>
                    <% end %>
                  </div>
              </div>
          </div>

        <div class="col-12 col-md-6 col-lg-5 ml-lg-auto">
          <div class="order-details-confirmation">

            <div class="cart-page-heading">
              <h5>Your Order</h5>
              <p>The Details</p>
            </div>

            <ul class="order-details-form mb-4">
              <li><span>Product</span> <span>Total</span></li>
              <li><span>Cocktail Yellow dress</span>
                <div class="input-group">
          <span class="input-group-btn">
              <button type="button" class="btn btn-number" disabled="disabled" data-type="minus" data-field="quant[1]">
                  <i class="fa fa-minus" aria-hidden="true"></i>
              </button>
          </span>
          <input type="text" name="quant[1]" class="form-control input-number" value="1" min="1" max="10" size="">
          <span class="input-group-btn">
              <button type="button" class="btn btn-number" data-type="plus" data-field="quant[1]">
                  <i class="fa fa-plus" aria-hidden="true"></i>
              </button>
          </span>
      </div> <span>$59.90</span></li>
              <li><span>Subtotal</span> <span>$59.90</span></li>
              <li><span>Shipping</span> <span>Free</span></li>
              <li><span>Total</span> <span>$59.90</span></li>
            </ul>


            <div id="accordion" role="tablist" class="mb-4">
              <div class="card">
                <div class="card-header" role="tab" id="headingOne">
                  <h6 class="mb-0">
                    <a data-toggle="collapse" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne"><i class="fa fa-circle-o mr-3"></i>Paypal</a>
                  </h6>
                </div>

                <div id="collapseOne" class="collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
                  <div class="card-body">
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin pharetra tempor so dales. Phasellus sagittis auctor gravida. Integ er bibendum sodales arcu id te mpus. Ut consectetur lacus.</p>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" role="tab" id="headingTwo">
                  <h6 class="mb-0">
                    <a class="collapsed" data-toggle="collapse" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo"><i class="fa fa-circle-o mr-3"></i>cash on delievery</a>
                  </h6>
                </div>
                <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo" data-parent="#accordion">
                  <div class="card-body">
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Explicabo quis in veritatis officia inventore, tempore provident dignissimos.</p>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" role="tab" id="headingThree">
                  <h6 class="mb-0">
                    <a class="collapsed" data-toggle="collapse" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree"><i class="fa fa-circle-o mr-3"></i>credit card</a>
                  </h6>
                </div>
                <div id="collapseThree" class="collapse" role="tabpanel" aria-labelledby="headingThree" data-parent="#accordion">
                  <div class="card-body">
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Esse quo sint repudiandae suscipit ab soluta delectus voluptate, vero vitae</p>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" role="tab" id="headingFour">
                  <h6 class="mb-0">
                    <a class="collapsed" data-toggle="collapse" href="#collapseFour" aria-expanded="true" aria-controls="collapseFour"><i class="fa fa-circle-o mr-3"></i>direct bank transfer</a>
                  </h6>
                </div>
                <div id="collapseFour" class="collapse show" role="tabpanel" aria-labelledby="headingThree" data-parent="#accordion">
                  <div class="card-body">
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Est cum autem eveniet saepe fugit, impedit magni.</p>
                  </div>
                </div>
              </div>
            </div>

            <a href="#" class="btn karl-checkout-btn">Place Order</a>
          </div>
        </div>

      </div>
    </div>
  </div>
  <!-- ****** Checkout Area End ****** -->

</div>
<!-- /.wrapper end -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-23581568-13');

  $(".checkout_details_area").hide();
  $(".loginform").hide();
  $(".signupform").hide();
  $(".addform").hide();
  <% if current_user%>
    $(".accenter").hide();
    $(".deldet").addClass("active");
    $(".accdet").removeClass("active");
    $(".checkout_details_area").show();
  <%else%>
    $(".accdet").addClass("active");
    $(".accenter").show();
    $(".deldet").removeClass("active");
  <%end%>
  $(".sign1").click(function(){
    $(".sign1").hide();
    $(".sign2").hide();
    $(".loginform").show();
  });

  $(".add").click(function(){
    $(".addform").slideToggle();
  });
  $(".sign2").click(function(){
    $(".sign1").hide();
    $(".sign2").hide();
    $(".signupform").show();
    $(".accdet").addClass('active');
    $(".accenter").show();
  });

  $(".deldet").click(function(){
    $(".checkout_details_area").slideToggle();
    $(".deldet").toggleClass('active');
    $("i", this).toggleClass("fa-plus-square fa-minus-square");
  });
  $(".accdet").click(function(){
    $(".accenter").slideToggle();
    $(".accdet").toggleClass('active');
    $("i", this).toggleClass("fa-plus-square fa-minus-square");
  });
  $(".signin").click(function(){
    $('.loginform').show();
    $('.signupform').hide();
  });
    $(".signuplink").click(function(){
    $('.loginform').hide();
    $('.signupform').show();
  });
   $("#master_order_order_type").on("change", function()
    { 

      if(master_order_order_type.value == "home delivery")
      {
        $('.add_address').show();
      }
      else
      {
        $('.add_address').hide();
      }
    });
   $('.btn-number').click(function(e){
    e.preventDefault();
    
    fieldName = $(this).attr('data-field');
    type      = $(this).attr('data-type');
    var input = $("input[name='"+fieldName+"']");
    var currentVal = parseInt(input.val());
    if (!isNaN(currentVal)) {
        if(type == 'minus') {
            
            if(currentVal > input.attr('min')) {
                input.val(currentVal - 1).change();
            } 
            if(parseInt(input.val()) == input.attr('min')) {
                $(this).attr('disabled', true);
            }

        } else if(type == 'plus') {

            if(currentVal < input.attr('max')) {
                input.val(currentVal + 1).change();
            }
            if(parseInt(input.val()) == input.attr('max')) {
                $(this).attr('disabled', true);
            }

        }
    } else {
        input.val(0);
    }
});
$('.input-number').focusin(function(){
   $(this).data('oldValue', $(this).val());
});
$('.input-number').change(function() {
    
    minValue =  parseInt($(this).attr('min'));
    maxValue =  parseInt($(this).attr('max'));
    valueCurrent = parseInt($(this).val());
    
    name = $(this).attr('name');
    if(valueCurrent >= minValue) {
        $(".btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
    } else {
        alert('Sorry, the minimum value was reached');
        $(this).val($(this).data('oldValue'));
    }
    if(valueCurrent <= maxValue) {
        $(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
    } else {
        alert('Sorry, the maximum value was reached');
        $(this).val($(this).data('oldValue'));
    }   
});
  $(document).ready(function(){
    $("#address_state").on("change", function(){
      $.ajax({
        url: '/change_city',
        method: 'GET',
        data: {
          state: $(this).val()
        }
      });
    });
  });
</script>
